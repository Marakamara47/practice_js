<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculus</title>
    <!-- links -->
    <link rel="stylesheet" href="../../styles/normalize.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/calc_style.css">
</head>
<body>
    <div class="wrapper">
        <aside>
            <nav>
                <div class="local_navigation">
                    <h2>Калькуляторы</h2>
                    <ul>
                        <li><button id="clasic" class="nav_button">Класический калькулятор</button></li>
                        <li><button id="curency" class="nav_button">Валютный калькулятор</button></li>
                        <li><button id="percent" class="nav_button">Процентный калькулятор</button></li>
                    </ul>
                </div>
                <!-- /.local_navigation -->
                <div class="global_navigation">
                    <h2>Глобальное меню</h2>
                    <ul>
                        <li><a href="../../index.html">Главная страница</a></li>
                        <li><a href="./calculus.html">Калькуляторы</a></li>
                        <li><a href="#">To-do list</a></li>
                        <li><a href="#">Игры</a></li>
                        <li><a href="#">API</a></li>
                        <li><a href="#">E-commerce</a></li>
                        <li><a href="#">React</a></li>
                    </ul>
                </div>
                <!-- /.global_navigation -->
            </nav>
        </aside>
        <main>
            <div id="clasic_block" class="calculus clasic">
                <div class="calc_block"> 
                    <div class="calculator">
                        <output></output>
                    </div>
                    <div class="calculator_description">
                        <h3>Класический калькулятор</h3>
                    <p>Данный калькулятор написан на нативном JavaScript, вcе его HTML елементы 
                        генерируются программно и стилизуются вручную используя CSS, для выполнения
                        расчетов используется подключаемая библиотека math.js.
                    </p>
                    </div>
                </div>
                
                <div class="calculator_code">
                    <pre>
----------------Калькулятор

const output = document.querySelector('output')

const div = document.createElement('div')
div.classList.add('keyboard')
document.querySelector('.calculator').appendChild(div)

'C CE % / 7 8 9 * 4 5 6 - 1 2 3 + 0 ( ) ='.split(' ')
    .map(symbol => {
        div.insertAdjacentHTML('beforeend', `&ltbutton value="${symbol}"
        >${symbol}&lt/button>`)
    })

div.addEventListener('click', e => {
    if(e.target.tagName === 'BUTTON') {
        calc(e.target.value)
    }
})

document.addEventListener('keydown', e => {
    if ((e.key).match(/[0-9%\/*\-+\(\)=]|Backspace|Enter/)) calc(e.key)
})

function calc(value) {
    if (value.match(/=|Enter/)) {
        try {
            if (output.textContent !== '') {
                output.textContent = Math.trunc(math.evaluate(output.textContent))
            }
        } catch {
            let oldValue = output.textContent
            let newValue = 'недопустимое выражение'

            output.textContent = newValue
            const timer = setTimeout(() => {
                output.textContent = oldValue
                clearTimeout(timer)
            }, 1500)
        }
    } else if (value === 'C') {
        output.textContent = ''
    } else if (value.match(/CE|Backspace/)) {
        output.textContent = output.textContent.substring
        (0, output.textContent.length - 1)
    } else {
        output.textContent += value
    }
}
                    </pre>
                </div>
            </div>
            <!-- /.clasic -->
            <div id="curency_block" class="calculus curency">
                <div class="curency_list">
                    <div id="curency_chart">

                    </div>
                    <!-- /.curency_chart -->
                    <div class="curency_calculator">
                        <form onsubmit="return false">
                            <select name="curency" id="dropdown">
                                <option>Выберите нужную монету здесь</option>
                            </select>
                            <input type="number" id="curence_get_number" placeholder="Напишите нужное количество">
                            <select name="curency" id="dropdown_price">
                                <option>Выберите нужную валюту для определения цены</option>
                                <option value="usd">USD</option>
                                <option value="uah">UAH</option>
                                <option value="eth">ETH</option>
                            </select>
                            <button class="curency_calculate" type="submit" onclick="getValue()">Вычислить</button>
                        </form>
                        <span id="curency_result">Pезультат вычеслений</span>
                        <p class="curency_description">
                            Данный калькулятор при загрузке страницы обращается на сервер Coingeco.com 
                            используя их API, в ответ на запрос сервер присылает информацию о названии монеты 
                            ее тикер и айди, после чего используя полученные айди калькулятор отправляет новый запрос, 
                            чтобы получить стоимость одной монеты в интересующей валюте. Затем калькулятор выдает пользователю 
                            запрашиваемый результат посчитав цену на стороне браузера.
                        </p>
                    </div>
                    <!-- /.curency_calculator -->
                </div>
                <!-- /.curency_list -->
                <div class="curency_code">
                    <pre>
----------------coingecko апи + создание карточек через цикл

request("GET", "https://api.coingecko.com/api/v3/coins/list")
.then((geko) => {
    let gekoParsing = JSON.parse(geko.target.responseText)

    for (let i = 0; i &lt= gekoParsing.length; i++) {
        let coinName = gekoParsing[i].name;
        let coinSymbol = gekoParsing[i].symbol;
        let coinId = gekoParsing[i].id;
        let curencyChart = document.getElementById('curency_chart');
        let div = document.createElement('div');

        let select = document.getElementById('dropdown');
        let optionAdd = document.createElement('option');
        
        div.id = coinId;
        div.className = "curency_card";
        div.innerHTML = `&lth2> &ltb>Имя:&lt/b> ${coinName} &lt/h2> 
        &ltspan> &ltb>Тикер:&lt/b> ${coinSymbol}&lt/span>`

        curencyChart.append(div);

        optionAdd.value = coinId;
        optionAdd.innerHTML = `${coinSymbol}`;
        select.append(optionAdd);
    }
}).catch()

function request(method, url) {
    return new Promise(function (resolve, reject) {
        let xhr = new XMLHttpRequest();
        xhr.open(method, url);
        xhr.onload = resolve;
        xhr.onerror = reject;
        xhr.send();
    });
};

----------------работа калькулятора

function getValue() {

    let getCoin = document.getElementById("dropdown");
    let getCoinValue = getCoin.value;

    let getNumber = document.getElementById("curence_get_number");
    let getNumberValue = getNumber.value;

    let getPrice = document.getElementById("dropdown_price");
    let getPriceValue = getPrice.value;

    request("GET", "https://api.coingecko.com/api/v3/simple/price?ids="
    +getCoinValue+"&vs_currencies="+getPriceValue)
    .then((coin) => {

        let coinParsing = JSON.parse(coin.target.responseText)     
        let curencyResult = getNumberValue*coinParsing[getCoinValue][getPriceValue];
        document.getElementById("curency_result").innerHTML = curencyResult;
    }).catch();
};
                    </pre>
                </div>
                <!-- /.curency_list -->
            </div>
            <!-- /.curency -->
            <div id="percent_block" class="calculus percent active">
                <div class="percent_calculator">
                    <div class="calculator_form">
                        <form id="percent_form" onsubmit="return false">
                            <select name="percent_type" id="percent_type">
                                <option value="0">Выберите нужный режим:</option>
                                <option value="1">Процент составляет от числа</option>
                                <option value="2">Сколько прoцентов составляет число</option>
                                <option value="3">Прибавить процент к числу</option>
                                <option value="4">Вычесть процент из числа</option>
                            </select>
                            <input type="number" placeholder="Искомое значение" id="percent_input">
                            <input type="number" placeholder="Число" id="percent_get_number">
                            <span id="percent_result">Результат</span>
                            <button id="percent_calculate" onclick="calculate()">Посчитать</button>
                        </form>
                    </div>
                    <!-- /.calculator_form -->
                    <div class="calculator_form_description">
                        <p>Данный калькулятор занимается подсчетами в 4 режимах. 
                            Функция Джаваскрипт обращается к дом элементам и берет вводимые пользователем значения, 
                            после чего она проверяет больше ли они нуля, на следующем этапе функция проверяет выбран 
                            ли режим в выпадающем списке, если все условия соблюдены то функция проведет соответствующие 
                            расчеты и запишет результат на страницу. Если в ходе исполнения сценария пользователь совершит ошибки, 
                            то система выведет предупреждение в окно браузера.
                        </p>
                    </div>
                </div>
                <!-- /.percent_calculator -->
                <div class="percent_description">
                    <pre>
----------------Процентный калькулятор

function calculate() {

let percentInput = document.getElementById("percent_input");
let percentInputValue = percentInput.value;

let percentGetNumber = document.getElementById("percent_get_number");
let percentGetNumberValue = percentGetNumber.value;

let percentDropdown = document.getElementById("percent_type");
let percentDropdownValue = percentDropdown.value;

let percentResultPrint = document.getElementById("percent_result");

if (percentInputValue > 0 && percentGetNumberValue > 0) {
    switch (percentDropdownValue) {

        case "0":
            alert('Ой, похоже вы не выбрали нужный режим.');
            break;

        case "1":
            let percentResult_1 = percentGetNumberValue * percentInputValue / 100;
            percentResultPrint.innerHTML = percentResult_1;
            break;

        case "2":
            let percentResult_2 = percentInputValue / percentGetNumberValue * 100;
            percentResultPrint.innerHTML = percentResult_2;
            break;

        case "3":
            let percentResult_3 = ((percentGetNumberValue / 100)*percentInputValue)
                                        + Number(percentGetNumberValue);
            percentResultPrint.innerHTML = percentResult_3;
            break;

        case "4":
            let percentResult_4 = Number(percentGetNumberValue) ;
                                - ((percentGetNumberValue / 100)*percentInputValue);
            percentResultPrint.innerHTML = percentResult_4;
            break;

        default: 
            alert("Ой, что-то пошло не по плану. Проверьте введеные данные");
            break;
    };
}else{
    alert("Введеные цифры должны быть больше нуля.");
};

};
                    </pre>
                </div>
                <!-- /.percent_description -->
            </div>
            <!-- /.percent -->
        </main>
    </div>
    <!-- /.wrapper -->
        <!-- math.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.0.0/math.min.js"></script>
        <!-- main scripts -->
    <script src="scripts/main.js"></script>
</body>
</html>